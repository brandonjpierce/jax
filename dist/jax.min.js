!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t:e.Jax=t(e)}(this,function(e){"use strict";function t(e){this.request=e,this.status=this.request.xhr.status,this.headers=this.parseHeaders(),this.data=this.parseData();var t=this.status/100|0;(4===t||5===t)&&(this.error=this.parseError())}function r(e,t){this.url=t,this.method=e,this.headers={},this.requestData={},this.queries=[]}function s(e,t){return new r(e,t)}var n={};return n.isObject=function(e){return e instanceof Object},n.size=function(e){var t=0;if(e)if(n.isObject(e))for(var r in e)e.hasOwnProperty(r)&&t++;else t=e.length;return t},n.getXhr=function(){var t=!1,r=["Microsoft.XMLHTTP","Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP"];if("XMLHttpRequest"in e)t=new e.XMLHttpRequest;else for(var s=0,n=r.length;s!==n;s++)try{t=new e.ActiveXObject(r[s])}catch(i){t=!1}return t},n.serialize=function(e){if(!n.isObject(e))return"";var t=[],r="";for(var s in e)if(e.hasOwnProperty(s)){var i=encodeURIComponent(s),o=encodeURIComponent(e[s]);t.push(i+"="+o)}return r=t.join("&")},n.unserialize=function(e){for(var t={},r=e.split("&"),s=0,n=r.length;s!==n;s++){var i=r[s].split("="),o=decodeURIComponent(i[0]),a=decodeURIComponent(i[1]);t[o]=a}return t},t.prototype.parseHeaders=function(){var e=this.request.xhr.getAllResponseHeaders(),t={};if(e)for(var r=e.split("\r\n"),s=0,n=r.length;s!==n;s++){var i=r[s],o=i.indexOf(": ");if(o>0){var a=i.substring(0,o),h=i.substring(o+2);t[a]=h}}return t["Content-Type"]||(t["Content-Type"]="application/json"),t},t.prototype.parseData=function(){var e=this.request.xhr.responseText||null,t=this.headers["Content-Type"];if(e){var r={"application/x-www-form-urlencoded":n.unserialize,"application/json":JSON.parse};r[t]&&(e=r[t](e))}return e},t.prototype.parseError=function(){var e=this.request.method,t=this.request.url;return new Error("Cannot "+e+" "+t)},r.prototype.header=function(e,t){if(e)if(n.isObject(e))for(var r in e)e.hasOwnProperty(r)&&(this.headers[r]=e[r]);else this.headers[e]=t;return this},r.prototype.type=function(e){return e&&(this.headers["Content-Type"]=e),this},r.prototype.auth=function(e,t){var r=btoa(e+":"+t);return this.header("Authorization","Basic "+r),this},r.prototype.cors=function(){return this.header("X-CORS-Enabled",!0),this.cors=!0,this},r.prototype.nocache=function(){return this.header({"Cache-Control":"no-cache",Expires:"-1","X-Requested-With":"XMLHttpRequest"}),this},r.prototype.query=function(e){return e&&(n.isObject(e)&&(e=n.serialize(e)),this.queries.push(e)),this},r.prototype.data=function(e,t){var r=n.size(this.requestData);if(n.isObject(e))if(r)for(var s in e)e.hasOwnProperty(s)&&(this.requestData[s]=e[s]);else this.requestData=e;else this.requestData[e]=t;return this},r.prototype.done=function(e){var r=this,s=this.xhr=n.getXhr(),i=this.requestData,o=this.queries;if(s.onreadystatechange=function(){if(4===s.readyState){if(0===s.status){var n=new Error("Cross domain request is not allowed");e(n,null)}try{var i=new t(r);e(null,i)}catch(o){var n=new Error("Unable to parse response");n.original=o,e(n,null)}}},n.size(o)){var a=o.join("&"),h=this.url.indexOf("?")>-1?"&":"?";this.url+=h+a}s.open(this.method,this.url,!0),this.cors&&(s.withCredentials=!0);for(var u in this.headers)this.headers.hasOwnProperty(u)&&s.setRequestHeader(u,this.headers[u]);n.size(i)&&(i="application/json"===this.headers["Content-Type"]?JSON.stringify(i):n.serialize(i)),s.send(i)},s.get=function(e){return new s("GET",e)},s.post=function(e){return new s("POST",e)},s.put=function(e){return new s("PUT",e)},s.del=function(e){return new s("DELETE",e)},s.Request=r,s.Response=t,s});