!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e:t.Jax=e(t)}(this,function(t){"use strict";function e(t){this.request=t,this.status=this.request.xhr.status,this.headers=this.parseHeaders(),this.data=this.parseData(),this.raw=this.request.xhr.responseText||null;var e=s(this.status/100);(4===e||5===e)&&(this.error=this.parseError())}function r(t,e){this.url=e,this.method=t,this.xhr=i.getXhr(),this.headers={},this.requestData={},this.queries=[]}function n(t,e,n){return n?new r(t,e).done(n):new r(t,e)}var s=Math.round,i={};return i.isObject=function(t){return t instanceof Object},i.isFunction=function(t){return t&&"[object Function]"=={}.toString.call(t)},i.size=function(t){var e=0;if(t)if(i.isObject(t))for(var r in t)t.hasOwnProperty(r)&&e++;else e=t.length;return e},i.getXhr=function(){var e=!1,r=["Microsoft.XMLHTTP","Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP"];if("XMLHttpRequest"in t)e=new t.XMLHttpRequest;else for(var n=0,s=r.length;n!==s;n++)try{e=new t.ActiveXObject(r[n])}catch(i){e=!1}return e},i.serialize=function(t){if(!i.isObject(t))return"";var e=[],r="";for(var n in t)if(t.hasOwnProperty(n)){var s=encodeURIComponent(n),o=encodeURIComponent(t[n]);e.push(s+"="+o)}return r=e.join("&")},i.unserialize=function(t){for(var e={},r=t.split("&"),n=0,s=r.length;n!==s;n++){var i=r[n].split("="),o=decodeURIComponent(i[0]),a=decodeURIComponent(i[1]);e[o]=a}return e},e.prototype.parseHeaders=function(){var t=this.request.xhr.getAllResponseHeaders(),e={};if(t)for(var r=t.split("\r\n"),n=0,s=r.length;n!==s;n++){var i=r[n],o=i.indexOf(": ");if(o>0){var a=i.substring(0,o),u=i.substring(o+2);e[a]=u}}return e["Content-Type"]||(e["Content-Type"]="application/json"),e},e.prototype.parseData=function(){var t=this.request.xhr.responseText||null,e=this.headers["Content-Type"];if(t){var r={"application/x-www-form-urlencoded":i.unserialize,"application/json":JSON.parse};r[e]&&(t=r[e](t))}return t},e.prototype.parseError=function(){var t=this.request.method,e=this.request.url;return new Error("Cannot "+t+" "+e)},r.prototype.header=function(t,e){if(t)if(i.isObject(t))for(var r in t)t.hasOwnProperty(r)&&(this.headers[r]=t[r]);else this.headers[t]=e;return this},r.prototype.type=function(t){return t&&(this.headers["Content-Type"]=t),this},r.prototype.cors=function(){return this.header("X-CORS-Enabled",!0),this.cors=!0,this},r.prototype.nocache=function(){return this.header({"Cache-Control":"no-cache",Expires:"-1","X-Requested-With":"XMLHttpRequest"}),this},r.prototype.query=function(t){return t&&(i.isObject(t)&&(t=i.serialize(t)),this.queries.push(t)),this},r.prototype.data=function(t,e){var r=i.size(this.requestData);if(i.isObject(t))if(r)for(var n in t)t.hasOwnProperty(n)&&(this.requestData[n]=t[n]);else this.requestData=t;else this.requestData[t]=e;return this},r.prototype.formatData=function(){var t=this.requestData;i.size(t)&&(t="application/json"===this.headers["Content-Type"]?JSON.stringify(t):i.serialize(t))},r.prototype.formatQueries=function(){var t=this.queries,e=this.url;if(i.size(t)){var r=t.join("&"),n=e.indexOf("?")>-1?"&":"?";e+=n+r}},r.prototype.formatHeaders=function(){var t=this.headers,e=this.xhr;for(var r in t)t.hasOwnProperty(r)&&e.setRequestHeader(r,t[r])},r.prototype.done=function(t){var r=this,n=this.xhr;n.onreadystatechange=function(){if(4===n.readyState){if(0===n.status){var s=new Error("Cross domain request is not allowed");t(s,null)}try{var i=new e(r);t(null,i)}catch(o){var s=new Error("Unable to parse response");s.original=o,t(s,null)}}},this.formatQueries(),n.open(this.method,this.url,!0),this.cors&&(n.withCredentials=!0),this.formatHeaders(),this.formatData(),n.send(this.requestData)},n.get=function(t,e){return e=i.isFunction(e)?e:null,new n("GET",t,e)},n.post=function(t,e){return e=i.isFunction(e)?e:null,new n("POST",t,e)},n.put=function(t,e){return e=i.isFunction(e)?e:null,new n("PUT",t,e)},n.del=function(t,e){return e=i.isFunction(e)?e:null,new n("DELETE",t,e)},n.Request=r,n.Response=e,n});