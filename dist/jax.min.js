!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t:e.Jax=t(e)}(this,function(e){"use strict";function t(e){this.request=e,this.status=this.request.xhr.status,this.headers=this.parseHeaders(),this.data=this.parseData(),this.raw=this.request.xhr.responseText||null;var t=this.status/100|0;(4===t||5===t)&&(this.error=this.parseError())}function r(e,t){this.url=t,this.method=e,this.headers={},this.requestData={},this.queries=[]}function n(e,t,n){return n?new r(e,t).done(n):new r(e,t)}var s={};return s.isObject=function(e){return e instanceof Object},s.isFunction=function(e){return e&&"[object Function]"=={}.toString.call(e)},s.size=function(e){var t=0;if(e)if(s.isObject(e))for(var r in e)e.hasOwnProperty(r)&&t++;else t=e.length;return t},s.getXhr=function(){var t=!1,r=["Microsoft.XMLHTTP","Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP"];if("XMLHttpRequest"in e)t=new e.XMLHttpRequest;else for(var n=0,s=r.length;n!==s;n++)try{t=new e.ActiveXObject(r[n])}catch(i){t=!1}return t},s.serialize=function(e){if(!s.isObject(e))return"";var t=[],r="";for(var n in e)if(e.hasOwnProperty(n)){var i=encodeURIComponent(n),o=encodeURIComponent(e[n]);t.push(i+"="+o)}return r=t.join("&")},s.unserialize=function(e){for(var t={},r=e.split("&"),n=0,s=r.length;n!==s;n++){var i=r[n].split("="),o=decodeURIComponent(i[0]),a=decodeURIComponent(i[1]);t[o]=a}return t},t.prototype.parseHeaders=function(){var e=this.request.xhr.getAllResponseHeaders(),t={};if(e)for(var r=e.split("\r\n"),n=0,s=r.length;n!==s;n++){var i=r[n],o=i.indexOf(": ");if(o>0){var a=i.substring(0,o),u=i.substring(o+2);t[a]=u}}return t["Content-Type"]||(t["Content-Type"]="application/json"),t},t.prototype.parseData=function(){var e=this.request.xhr.responseText||null,t=this.headers["Content-Type"];if(e){var r={"application/x-www-form-urlencoded":s.unserialize,"application/json":JSON.parse};r[t]&&(e=r[t](e))}return e},t.prototype.parseError=function(){var e=this.request.method,t=this.request.url;return new Error("Cannot "+e+" "+t)},r.prototype.header=function(e,t){if(e)if(s.isObject(e))for(var r in e)e.hasOwnProperty(r)&&(this.headers[r]=e[r]);else this.headers[e]=t;return this},r.prototype.type=function(e){return e&&(this.headers["Content-Type"]=e),this},r.prototype.cors=function(){return this.header("X-CORS-Enabled",!0),this.cors=!0,this},r.prototype.nocache=function(){return this.header({"Cache-Control":"no-cache",Expires:"-1","X-Requested-With":"XMLHttpRequest"}),this},r.prototype.query=function(e){return e&&(s.isObject(e)&&(e=s.serialize(e)),this.queries.push(e)),this},r.prototype.data=function(e,t){var r=s.size(this.requestData);if(s.isObject(e))if(r)for(var n in e)e.hasOwnProperty(n)&&(this.requestData[n]=e[n]);else this.requestData=e;else this.requestData[e]=t;return this},r.prototype.done=function(e){var r=this,n=this.xhr=s.getXhr(),i=this.requestData,o=this.queries;if(n.onreadystatechange=function(){if(4===n.readyState){if(0===n.status){var s=new Error("Cross domain request is not allowed");e(s,null)}try{var i=new t(r);e(null,i)}catch(o){var s=new Error("Unable to parse response");s.original=o,e(s,null)}}},s.size(o)){var a=o.join("&"),u=this.url.indexOf("?")>-1?"&":"?";this.url+=u+a}n.open(this.method,this.url,!0),this.cors&&(n.withCredentials=!0);for(var h in this.headers)this.headers.hasOwnProperty(h)&&n.setRequestHeader(h,this.headers[h]);s.size(i)&&(i="application/json"===this.headers["Content-Type"]?JSON.stringify(i):s.serialize(i)),n.send(i)},n.get=function(e,t){return t=s.isFunction(t)?t:null,new n("GET",e,t)},n.post=function(e,t){return t=s.isFunction(t)?t:null,new n("POST",e,t)},n.put=function(e,t){return t=s.isFunction(t)?t:null,new n("PUT",e,t)},n.del=function(e,t){return t=s.isFunction(t)?t:null,new n("DELETE",e,t)},n.Request=r,n.Response=t,n});